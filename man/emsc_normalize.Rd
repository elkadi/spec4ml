% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/emsc_normalize.R
\name{emsc_normalize}
\alias{emsc_normalize}
\title{EMSC Normalization of NIR Spectra}
\usage{
emsc_normalize(
  spectra_file,
  controls_file,
  output_file = "NIR_spectra.csv",
  group_col = "Day",
  spectra_dir = "../InputSpectra",
  output_dir = "../Normalized_Spectra",
  save_output = TRUE
)
}
\arguments{
\item{spectra_file}{Character string. Name of the CSV file containing spectra data.}

\item{controls_file}{Character string. Name of the CSV file containing control data.}

\item{output_file}{Character string. Name of the output CSV file to save normalized data.
Defaults to `"Spectra_Normalized.csv"`.}

\item{group_col}{Character string. Name of the column used to group data for normalization
(e.g., `"Day"`). Defaults to `"Day"`.}

\item{spectra_dir}{Character string. Directory path containing the input spectra and control files.
Defaults to `"../InputSpectra"`.}

\item{output_dir}{Character string. Directory path to save the normalized output.
Defaults to `"../Normalized_Spectra"`.}

\item{save_output}{Logical. If `TRUE`, the normalized spectra are saved to disk.
If `FALSE`, only the resulting dataframe is returned. Defaults to `TRUE`.}
}
\value{
A data frame containing the EMSC-normalized spectra combined with metadata.
}
\description{
Applies Extended Multiplicative Signal Correction (EMSC) normalization
to Near-Infrared (NIR) spectral data using reference controls averaged
by a specified grouping variable (e.g., "Day").
}
\details{
This function reads input spectral and control data, computes mean reference
spectra for each group, applies EMSC normalization to each group of spectra,
and optionally saves the normalized spectra to a CSV file.


The function identifies the start of the spectral region by detecting
the first numeric column in the input data. Metadata columns are preserved
and reattached to the normalized spectra.

For each group (as defined by `group_col`), the function:
1. Computes the mean control spectrum (`NIRC_Averages`).
2. Builds an EMSC model based on the mean spectrum.
3. Normalizes each corresponding spectral subset using that model.
}
\examples{
\dontrun{
# Normalize and save to file
emsc_normalize(
  spectra_file = "NIR_spectra.csv",
  controls_file = "Control_spectra.csv"
)

# Normalize and return data only
normalized_df <- emsc_normalize(
  spectra_file = "NIR_spectra.csv",
  controls_file = "Control_spectra.csv",
  save_output = FALSE
)
}

}
